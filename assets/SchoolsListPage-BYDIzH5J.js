import{u as M,j as e,B as k,i as b,L as S,N as f,O as v,P as C,v as y,J as L,x as m,y as a,w as I,b as u,Q as B,R,n as F,d as T,U as A,e as N,o as W,t as _,V as O,r as h}from"./vendor-mui-CCOHixrn.js";import{r as c,L as V}from"./vendor-react-CSxt_BGh.js";import{u as z}from"./useSchoolList-CX6H3ZNN.js";import{u as D}from"./useFocusOnNavigation-CxCOhBMX.js";import{u as E}from"./index-BAqkaTXI.js";import"./vendor-tanstack-DTWbCzqv.js";const K=i=>{const r=M(),{count:l,page:t,rowsPerPage:o,onPageChange:d}=i,w=s=>{d(s,0)},x=s=>{d(s,t-1)},j=s=>{d(s,t+1)},g=s=>{d(s,Math.max(0,Math.ceil(l/o)-1))};return e.jsxs(k,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(b,{onClick:w,disabled:t===0,"aria-label":"first page",children:r.direction==="rtl"?e.jsx(S,{}):e.jsx(f,{})}),e.jsx(b,{onClick:x,disabled:t===0,"aria-label":"previous page",children:r.direction==="rtl"?e.jsx(v,{}):e.jsx(C,{})}),e.jsx(b,{onClick:j,disabled:t>=Math.ceil(l/o)-1,"aria-label":"next page",children:r.direction==="rtl"?e.jsx(C,{}):e.jsx(v,{})}),e.jsx(b,{onClick:g,disabled:t>=Math.ceil(l/o)-1,"aria-label":"last page",children:r.direction==="rtl"?e.jsx(f,{}):e.jsx(S,{})})]})},P={textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},U=({schools:i})=>{const[r,l]=c.useState(0),[t,o]=c.useState(12),[d,w]=c.useState(i);i!==d&&(w(i),l(0));const x=r>0?Math.max(0,(1+r)*t-i.length):0,j=(s,n)=>{l(n)},g=s=>{o(parseInt(s.target.value,10)),l(0)};return e.jsxs(y,{sx:{minWidth:300,p:0},"aria-label":"Searchable list of New Zealand schools",children:[e.jsx(L,{children:e.jsxs(m,{children:[e.jsx(a,{align:"left",children:"Name"}),e.jsx(a,{align:"left",children:"City"}),e.jsx(a,{align:"right",children:"Students"}),e.jsx(a,{align:"right",children:"Website"})]})}),e.jsxs(I,{children:[(t>0?i.slice(r*t,r*t+t):i).map(s=>e.jsxs(m,{children:[e.jsx(a,{sx:{width:300},scope:"row",children:e.jsx(V,{to:"/schools/"+s.schoolId,className:"school-list-item",children:e.jsx(u,{sx:P,children:s.name})},s.schoolId)}),e.jsx(a,{sx:{width:100},scope:"row",children:e.jsx(u,{sx:P,children:s.city})}),e.jsx(a,{sx:{width:100},align:"right",children:s.total}),e.jsx(a,{sx:{width:100},align:"right",children:e.jsx(u,{sx:P,children:e.jsx("a",{href:s.url,target:"_blank",rel:"noopener noreferrer",children:s.url})})})]},s.schoolId)),x>0&&e.jsx(m,{style:{height:53*x},children:e.jsx(a,{colSpan:6})})]}),e.jsx(B,{children:e.jsx(m,{children:e.jsx(R,{rowsPerPageOptions:[12,24],colSpan:4,count:i.length,rowsPerPage:t,page:r,slotProps:{select:{inputProps:{"aria-label":"rows per page"},native:!0},actions:K},onPageChange:j,onRowsPerPageChange:g})})})]})},q=()=>{const i=D(),[r,l]=c.useState(""),t=c.useDeferredValue(r),{data:o,error:d,isPending:w}=z();E("Find a School - Schools Viewer");const x=c.useMemo(()=>o?.reduce((n,p)=>n.set(p.schoolId,p),new Map),[o]),j=c.useMemo(()=>o?.map((n,p)=>({id:n.schoolId,i:p,name:n.name.replace(/[.,/#!$%^&*;:{}=\-_'`~()]/g,"").toLowerCase()}))??[],[o]),g=c.useMemo(()=>t.replace(/[.,/#!$%^&*;:{}=\-_'`~()]/g,"").toLowerCase(),[t]),s=c.useMemo(()=>j.filter(n=>n.name.includes(g)).map(n=>x?.get(n.id)).filter(n=>n!==void 0),[j,g,x]);return e.jsxs(F,{id:"schools-list-section",component:"section",maxWidth:"xl",children:[e.jsxs(T,{direction:"row",my:3,alignItems:"center",children:[e.jsx(u,{variant:"h4",component:"h1",ref:i,tabIndex:-1,sx:{outline:"none"},children:"Find a school"}),e.jsx(k,{flexGrow:1}),e.jsx(A,{value:r,onChange:n=>l(n.target.value.toLowerCase()),sx:{minWidth:300},label:"Search schools",slotProps:{input:{endAdornment:e.jsx(N,{})}},size:"small"})]}),d&&e.jsxs(T,{spacing:2,alignItems:"flex-start",mb:3,role:"alert",children:[e.jsx(u,{variant:"h6",color:"error",children:"Unable to Load Schools"}),e.jsx(u,{color:"text.secondary",children:"We're having trouble connecting to the schools database. Please check your internet connection and try again."}),e.jsx(W,{variant:"contained",onClick:()=>window.location.reload(),children:"Try Again"})]}),s.length>0&&e.jsx(U,{schools:s}),w&&e.jsx(_,{component:O,role:"status","aria-live":"polite","aria-label":"Loading schools data",children:e.jsxs(y,{children:[e.jsx(L,{children:e.jsxs(m,{children:[e.jsx(a,{children:e.jsx(h,{variant:"text",width:"60%"})}),e.jsx(a,{children:e.jsx(h,{variant:"text",width:"80%"})}),e.jsx(a,{children:e.jsx(h,{variant:"text",width:"40%"})}),e.jsx(a,{children:e.jsx(h,{variant:"text",width:"50%"})})]})}),e.jsx(I,{children:[...Array(10)].map((n,p)=>e.jsxs(m,{children:[e.jsx(a,{children:e.jsx(h,{variant:"text"})}),e.jsx(a,{children:e.jsx(h,{variant:"text"})}),e.jsx(a,{children:e.jsx(h,{variant:"text"})}),e.jsx(a,{children:e.jsx(h,{variant:"text"})})]},p))})]})})]})};export{q as SchoolsListPage};
