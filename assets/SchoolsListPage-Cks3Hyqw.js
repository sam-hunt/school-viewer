import{u as B,j as e,B as T,i as w,L as S,N as P,O as k,P as v,v as I,J as L,x as b,y as a,w as M,Q as C,b as m,R as N,U as R,V as z,n as F,d as y,W,X as $,e as A,o as _,t as O,Y as V,s as x}from"./vendor-mui-muqmfo5Z.js";import{r as h}from"./vendor-react-CSxt_BGh.js";import{u as D}from"./useSchoolList-DQZos8bm.js";import{u as E}from"./useFocusOnNavigation-CxCOhBMX.js";import{u as K}from"./index-CFGUzlIS.js";import"./vendor-tanstack-Ig1BFDt_.js";const U=o=>{const l=B(),{count:i,page:t,rowsPerPage:r,onPageChange:c}=o,j=s=>{c(s,0)},g=s=>{c(s,t-1)},p=s=>{c(s,t+1)},u=s=>{c(s,Math.max(0,Math.ceil(i/r)-1))};return e.jsxs(T,{sx:{flexShrink:0,ml:2.5},children:[e.jsx(w,{onClick:j,disabled:t===0,"aria-label":"first page",children:l.direction==="rtl"?e.jsx(S,{}):e.jsx(P,{})}),e.jsx(w,{onClick:g,disabled:t===0,"aria-label":"previous page",children:l.direction==="rtl"?e.jsx(k,{}):e.jsx(v,{})}),e.jsx(w,{onClick:p,disabled:t>=Math.ceil(i/r)-1,"aria-label":"next page",children:l.direction==="rtl"?e.jsx(v,{}):e.jsx(k,{})}),e.jsx(w,{onClick:u,disabled:t>=Math.ceil(i/r)-1,"aria-label":"last page",children:l.direction==="rtl"?e.jsx(P,{}):e.jsx(S,{})})]})},f={textOverflow:"ellipsis",whiteSpace:"nowrap",overflow:"hidden"},G={display:"flex",justifyContent:"flex-end",alignItems:"center",gap:.5,...f},H=({schools:o})=>{const[l,i]=h.useState(0),[t,r]=h.useState(12),[c,j]=h.useState(o);o!==c&&(j(o),i(0));const g=l>0?Math.max(0,(1+l)*t-o.length):0,p=(s,n)=>{i(n)},u=s=>{r(parseInt(s.target.value,10)),i(0)};return e.jsxs(I,{sx:{p:0,"& .MuiTableCell-root":{px:{xs:1,sm:2}}},"aria-label":"Searchable list of New Zealand schools",children:[e.jsx(L,{children:e.jsxs(b,{children:[e.jsx(a,{align:"left",sx:{width:"100%"},children:"Name"}),e.jsx(a,{align:"left",sx:{display:{xs:"none",sm:"table-cell"}},children:"City"}),e.jsx(a,{align:"right",children:"Students"}),e.jsx(a,{align:"right",sx:{display:{xs:"none",sm:"none",md:"table-cell"}},children:"Website"})]})}),e.jsxs(M,{children:[(t>0?o.slice(l*t,l*t+t):o).map(s=>e.jsxs(b,{children:[e.jsx(a,{sx:{width:"100%",maxWidth:0},scope:"row",children:e.jsx(C,{href:`/schools/${s.schoolId}`,className:"school-list-item",children:e.jsx(m,{sx:f,children:s.name})},s.schoolId)}),e.jsx(a,{sx:{display:{xs:"none",sm:"table-cell"}},scope:"row",children:e.jsx(m,{sx:f,children:s.city})}),e.jsx(a,{align:"right",children:s.total}),e.jsx(a,{sx:{...f,display:{xs:"none",sm:"none",md:"table-cell"}},align:"right",children:s.url?e.jsxs(C,{href:s.url,target:"_blank",rel:"noopener noreferrer",sx:G,children:[s.url,e.jsx(N,{sx:{fontSize:"1rem"}})]}):e.jsx(m,{fontSize:"small",color:"text.secondary",sx:f,children:"No website available"})})]},s.schoolId)),g>0&&e.jsx(b,{style:{height:53*g},children:e.jsx(a,{colSpan:6})})]}),e.jsx(R,{children:e.jsx(b,{children:e.jsx(z,{rowsPerPageOptions:[12,24],colSpan:4,count:o.length,rowsPerPage:t,page:l,slotProps:{select:{inputProps:{"aria-label":"rows per page"},native:!0},actions:U},onPageChange:p,onRowsPerPageChange:u})})})]})},ee=()=>{const o=E(),[l,i]=h.useState(""),t=h.useDeferredValue(l),{data:r,error:c,isPending:j}=D();K("Find a School - Schools Viewer");const g=h.useMemo(()=>r?.reduce((n,d)=>n.set(d.schoolId,d),new Map),[r]),p=h.useMemo(()=>r?.map((n,d)=>({id:n.schoolId,i:d,name:n.name.replace(/[.,/#!$%^&*;:{}=\-_'`~()]/g,"").toLowerCase()}))??[],[r]),u=h.useMemo(()=>t.trim().toLocaleLowerCase().replace(/[.,/#!$%^&*;:{}=\-_'`~()]/g,""),[t]),s=h.useMemo(()=>p.filter(n=>n.name.includes(u)).map(n=>g?.get(n.id)).filter(n=>n!==void 0),[p,u,g]);return e.jsxs(F,{id:"schools-list-section",component:"section",maxWidth:"xl",children:[e.jsxs(y,{direction:{xs:"column",sm:"row"},my:3,spacing:2,alignItems:{xs:"stretch",sm:"center"},children:[e.jsx(m,{variant:"h4",component:"h1",ref:o,tabIndex:-1,sx:{outline:"none"},children:"Find a school"}),e.jsx(T,{flexGrow:1,sx:{display:{xs:"none",sm:"block"}}}),e.jsx(W,{value:l,onChange:n=>i(n.target.value),sx:{minWidth:{xs:"100%",sm:300}},label:"Search schools",slotProps:{input:{endAdornment:l?e.jsx(w,{"aria-label":"Clear search",onClick:()=>i(""),edge:"end",size:"small",children:e.jsx($,{fontSize:"small"})}):e.jsx(A,{})}},size:"small"})]}),c&&e.jsxs(y,{spacing:2,alignItems:"flex-start",mb:3,role:"alert",children:[e.jsx(m,{variant:"h6",color:"error",children:"Unable to Load Schools"}),e.jsx(m,{color:"text.secondary",children:"We're having trouble connecting to the schools database. Please check your internet connection and try again."}),e.jsx(_,{variant:"contained",onClick:()=>window.location.reload(),children:"Try Again"})]}),!j&&!c&&s.length>0&&e.jsx(H,{schools:s}),!j&&!c&&s.length===0&&t&&e.jsxs(y,{spacing:2,alignItems:"center",py:6,children:[e.jsx(m,{variant:"h6",color:"text.secondary",children:"No schools found"}),e.jsxs(m,{color:"text.secondary",children:['No schools match your search for "',t,'". Try a different search term.']})]}),j&&e.jsx(O,{component:V,role:"status","aria-live":"polite","aria-label":"Loading schools data",children:e.jsxs(I,{children:[e.jsx(L,{children:e.jsxs(b,{children:[e.jsx(a,{children:e.jsx(x,{"data-testid":"skeleton-schools-table-header-name",variant:"text",width:"60%"})}),e.jsx(a,{sx:{display:{xs:"none",sm:"table-cell"}},children:e.jsx(x,{"data-testid":"skeleton-schools-table-header-city",variant:"text",width:"80%"})}),e.jsx(a,{children:e.jsx(x,{"data-testid":"skeleton-schools-table-header-students",variant:"text",width:"40%"})}),e.jsx(a,{sx:{display:{xs:"none",sm:"none",md:"table-cell"}},children:e.jsx(x,{"data-testid":"skeleton-schools-table-header-website",variant:"text",width:"50%"})})]})}),e.jsx(M,{children:Array.from({length:13},(n,d)=>e.jsxs(b,{children:[e.jsx(a,{children:e.jsx(x,{"data-testid":`skeleton-schools-table-row-${d.toString()}-name`,variant:"text"})}),e.jsx(a,{sx:{display:{xs:"none",sm:"table-cell"}},children:e.jsx(x,{"data-testid":`skeleton-schools-table-row-${d.toString()}-city`,variant:"text"})}),e.jsx(a,{children:e.jsx(x,{"data-testid":`skeleton-schools-table-row-${d.toString()}-students`,variant:"text"})}),e.jsx(a,{sx:{display:{xs:"none",sm:"none",md:"table-cell"}},children:e.jsx(x,{"data-testid":`skeleton-schools-table-row-${d.toString()}-website`,variant:"text"})})]},d))})]})})]})};export{ee as SchoolsListPage};
