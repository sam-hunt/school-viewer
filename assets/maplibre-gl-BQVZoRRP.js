const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/maplibre-gl-DJrL2sKv.js","assets/vendor-react-CSxt_BGh.js"])))=>i.map(i=>d[i]);
import{r as a,c as I}from"./vendor-react-CSxt_BGh.js";import{_ as F}from"./index-DGJYjs-j.js";const D=a.createContext(null);function H(e,n){const t=Array.isArray(e)?e[0]:e?e.x:0,i=Array.isArray(e)?e[1]:e?e.y:0,r=Array.isArray(n)?n[0]:n?n.x:0,o=Array.isArray(n)?n[1]:n?n.y:0;return t===r&&i===o}function h(e,n){if(e===n)return!0;if(!e||!n)return!1;if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(!h(e[t],n[t]))return!1;return!0}else if(Array.isArray(n))return!1;if(typeof e=="object"&&typeof n=="object"){const t=Object.keys(e),i=Object.keys(n);if(t.length!==i.length)return!1;for(const r of t)if(!n.hasOwnProperty(r)||!h(e[r],n[r]))return!1;return!0}return!1}function w(e){return{longitude:e.center.lng,latitude:e.center.lat,zoom:e.zoom,pitch:e.pitch,bearing:e.bearing,padding:e.padding}}function R(e,n){const t=n.viewState||n,i={};if("longitude"in t&&"latitude"in t&&(t.longitude!==e.center.lng||t.latitude!==e.center.lat)){const r=e.center.constructor;i.center=new r(t.longitude,t.latitude)}return"zoom"in t&&t.zoom!==e.zoom&&(i.zoom=t.zoom),"bearing"in t&&t.bearing!==e.bearing&&(i.bearing=t.bearing),"pitch"in t&&t.pitch!==e.pitch&&(i.pitch=t.pitch),t.padding&&e.padding&&!h(t.padding,e.padding)&&(i.padding=t.padding),i}const W=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function b(e){if(!e)return null;if(typeof e=="string"||("toJS"in e&&(e=e.toJS()),!e.layers))return e;const n={};for(const i of e.layers)n[i.id]=i;const t=e.layers.map(i=>{let r=null;"interactive"in i&&(r=Object.assign({},i),delete r.interactive);const o=n[i.ref];if(o){r=r||Object.assign({},i),delete r.ref;for(const s of W)s in o&&(r[s]=o[s])}return r||i});return{...e,layers:t}}const P={version:8,sources:{},layers:[]},T={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},k={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},z={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},Z=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],j=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class C{constructor(n,t,i){this._map=null,this._internalUpdate=!1,this._hoveredFeatures=null,this._propsedCameraUpdate=null,this._styleComponents={},this._onEvent=r=>{const o=this.props[z[r.type]];o?o(r):r.type==="error"&&console.error(r.error)},this._onCameraEvent=r=>{if(this._internalUpdate)return;r.viewState=this._propsedCameraUpdate||w(this._map.transform);const o=this.props[k[r.type]];o&&o(r)},this._onCameraUpdate=r=>this._internalUpdate?r:(this._propsedCameraUpdate=w(r),R(r,this.props)),this._onPointerEvent=r=>{(r.type==="mousemove"||r.type==="mouseout")&&this._updateHover(r);const o=this.props[T[r.type]];o&&(this.props.interactiveLayerIds&&r.type!=="mouseover"&&r.type!=="mouseout"&&(r.features=this._hoveredFeatures||this._queryRenderedFeatures(r.point)),o(r),delete r.features)},this._MapClass=n,this.props=t,this._initialize(i)}get map(){return this._map}setProps(n){const t=this.props;this.props=n;const i=this._updateSettings(n,t),r=this._updateSize(n),o=this._updateViewState(n);this._updateStyle(n,t),this._updateStyleComponents(n),this._updateHandlers(n,t),(i||r||o&&!this._map.isMoving())&&this.redraw()}static reuse(n,t){const i=C.savedMaps.pop();if(!i)return null;const r=i.map,o=r.getContainer();for(t.className=o.className;o.childNodes.length>0;)t.appendChild(o.childNodes[0]);r._container=t;const s=r._resizeObserver;s&&(s.disconnect(),s.observe(t)),i.setProps({...n,styleDiffing:!1}),r.resize();const{initialViewState:c}=n;return c&&(c.bounds?r.fitBounds(c.bounds,{...c.fitBoundsOptions,duration:0}):i._updateViewState(c)),r.isStyleLoaded()?r.fire("load"):r.once("style.load",()=>r.fire("load")),r._update(),i}_initialize(n){const{props:t}=this,{mapStyle:i=P}=t,r={...t,...t.initialViewState,container:n,style:b(i)},o=r.initialViewState||r.viewState||r;if(Object.assign(r,{center:[o.longitude||0,o.latitude||0],zoom:o.zoom||0,pitch:o.pitch||0,bearing:o.bearing||0}),t.gl){const c=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=c,t.gl)}const s=new this._MapClass(r);o.padding&&s.setPadding(o.padding),t.cursor&&(s.getCanvas().style.cursor=t.cursor),s.transformCameraUpdate=this._onCameraUpdate,s.on("style.load",()=>{this._styleComponents={light:s.getLight(),sky:s.getSky(),projection:s.getProjection?.(),terrain:s.getTerrain()},this._updateStyleComponents(this.props)}),s.on("sourcedata",()=>{this._updateStyleComponents(this.props)});for(const c in T)s.on(c,this._onPointerEvent);for(const c in k)s.on(c,this._onCameraEvent);for(const c in z)s.on(c,this._onEvent);this._map=s}recycle(){this.map.getContainer().querySelector("[mapboxgl-children]")?.remove(),C.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const n=this._map;n.style&&(n._frame&&(n._frame.cancel(),n._frame=null),n._render())}_updateSize(n){const{viewState:t}=n;if(t){const i=this._map;if(t.width!==i.transform.width||t.height!==i.transform.height)return i.resize(),!0}return!1}_updateViewState(n){const t=this._map,i=t.transform;if(!t.isMoving()){const o=R(i,n);if(Object.keys(o).length>0)return this._internalUpdate=!0,t.jumpTo(o),this._internalUpdate=!1,!0}return!1}_updateSettings(n,t){const i=this._map;let r=!1;for(const o of Z)o in n&&!h(n[o],t[o])&&(r=!0,i[`set${o[0].toUpperCase()}${o.slice(1)}`]?.call(i,n[o]));return r}_updateStyle(n,t){if(n.cursor!==t.cursor&&(this._map.getCanvas().style.cursor=n.cursor||""),n.mapStyle!==t.mapStyle){const{mapStyle:i=P,styleDiffing:r=!0}=n,o={diff:r};"localIdeographFontFamily"in n&&(o.localIdeographFontFamily=n.localIdeographFontFamily),this._map.setStyle(b(i),o)}}_updateStyleComponents({light:n,projection:t,sky:i,terrain:r}){const o=this._map,s=this._styleComponents;o.style._loaded&&(n&&!h(n,s.light)&&(s.light=n,o.setLight(n)),t&&!h(t,s.projection)&&t!==s.projection?.type&&(s.projection=typeof t=="string"?{type:t}:t,o.setProjection?.(s.projection)),i&&!h(i,s.sky)&&(s.sky=i,o.setSky(i)),r!==void 0&&!h(r,s.terrain)&&(!r||o.getSource(r.source))&&(s.terrain=r,o.setTerrain(r)))}_updateHandlers(n,t){const i=this._map;for(const r of j){const o=n[r]??!0,s=t[r]??!0;h(o,s)||(o?i[r].enable(o):i[r].disable())}}_queryRenderedFeatures(n){const t=this._map,{interactiveLayerIds:i=[]}=this.props;try{return t.queryRenderedFeatures(n,{layers:i.filter(t.getLayer.bind(t))})}catch{return[]}}_updateHover(n){const{props:t}=this;if(t.interactiveLayerIds&&(t.onMouseMove||t.onMouseEnter||t.onMouseLeave)){const r=n.type,o=this._hoveredFeatures?.length>0,s=this._queryRenderedFeatures(n.point),c=s.length>0;!c&&o&&(n.type="mouseleave",this._onPointerEvent(n)),this._hoveredFeatures=s,c&&!o&&(n.type="mouseenter",this._onPointerEvent(n)),n.type=r}else this._hoveredFeatures=null}}C.savedMaps=[];const V=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function q(e){if(!e)return null;const n=e.map,t={getMap:()=>n};for(const i of B(n))!(i in t)&&!V.includes(i)&&(t[i]=n[i].bind(n));return t}function B(e){const n=new Set;let t=e;for(;t;){for(const i of Object.getOwnPropertyNames(t))i[0]!=="_"&&typeof e[i]=="function"&&i!=="fire"&&i!=="setEventedParent"&&n.add(i);t=Object.getPrototypeOf(t)}return Array.from(n)}const G=typeof document<"u"?a.useLayoutEffect:a.useEffect;function $(e,n){const{RTLTextPlugin:t,maxParallelImageRequests:i,workerCount:r,workerUrl:o}=n;if(t&&e.getRTLTextPluginStatus&&e.getRTLTextPluginStatus()==="unavailable"){const{pluginUrl:s,lazy:c=!0}=typeof t=="string"?{pluginUrl:t}:t;e.setRTLTextPlugin(s,l=>{l&&console.error(l)},c)}i!==void 0&&e.setMaxParallelImageRequests(i),r!==void 0&&e.setWorkerCount(r),o!==void 0&&e.setWorkerUrl(o)}const M=a.createContext(null);function J(e,n){const t=a.useContext(D),[i,r]=a.useState(null),o=a.useRef(),{current:s}=a.useRef({mapLib:null,map:null});a.useEffect(()=>{const u=e.mapLib;let E=!0,d;return Promise.resolve(u||F(()=>import("./maplibre-gl-DJrL2sKv.js").then(f=>f.m),__vite__mapDeps([0,1]))).then(f=>{if(!E)return;if(!f)throw new Error("Invalid mapLib");const m="Map"in f?f:f.default;if(!m.Map)throw new Error("Invalid mapLib");$(m,e),e.reuseMaps&&(d=C.reuse(e,o.current)),d||(d=new C(m.Map,e,o.current)),s.map=q(d),s.mapLib=m,r(d),t?.onMapMount(s.map,e.id)}).catch(f=>{const{onError:m}=e;m?m({type:"error",target:null,originalEvent:null,error:f}):console.error(f)}),()=>{E=!1,d&&(t?.onMapUnmount(e.id),e.reuseMaps?d.recycle():d.destroy())}},[]),G(()=>{i&&i.setProps(e)}),a.useImperativeHandle(n,()=>s.map,[i]);const c=a.useMemo(()=>({position:"relative",width:"100%",height:"100%",...e.style}),[e.style]),l={height:"100%"};return a.createElement("div",{id:e.id,ref:o,style:c},i&&a.createElement(M.Provider,{value:s},a.createElement("div",{"mapboxgl-children":"",style:l},e.children)))}const se=a.forwardRef(J),K=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function p(e,n){if(!e||!n)return;const t=e.style;for(const i in n){const r=n[i];Number.isFinite(r)&&!K.test(i)?t[i]=`${r}px`:t[i]=r}}function O(e,n){if(e===n)return null;const t=N(e),i=N(n),r=[];for(const o of i)t.has(o)||r.push(o);for(const o of t)i.has(o)||r.push(o);return r.length===0?null:r}function N(e){return new Set(e?e.trim().split(/\s+/):[])}const ae=a.memo(a.forwardRef((e,n)=>{const{map:t,mapLib:i}=a.useContext(M),r=a.useRef({props:e}),o=a.useMemo(()=>{let L=!1;a.Children.forEach(e.children,g=>{g&&(L=!0)});const U={...e,element:L?document.createElement("div"):void 0},v=new i.Marker(U);return v.setLngLat([e.longitude,e.latitude]),v.getElement().addEventListener("click",g=>{r.current.props.onClick?.({type:"click",target:v,originalEvent:g})}),v.on("dragstart",g=>{const y=g;y.lngLat=o.getLngLat(),r.current.props.onDragStart?.(y)}),v.on("drag",g=>{const y=g;y.lngLat=o.getLngLat(),r.current.props.onDrag?.(y)}),v.on("dragend",g=>{const y=g;y.lngLat=o.getLngLat(),r.current.props.onDragEnd?.(y)}),v},[]);a.useEffect(()=>(o.addTo(t.getMap()),()=>{o.remove()}),[]);const{longitude:s,latitude:c,offset:l,style:u,draggable:E=!1,popup:d=null,rotation:f=0,rotationAlignment:m="auto",pitchAlignment:S="auto"}=e;a.useEffect(()=>{p(o.getElement(),u)},[u]),a.useImperativeHandle(n,()=>o,[]);const A=r.current.props;(o.getLngLat().lng!==s||o.getLngLat().lat!==c)&&o.setLngLat([s,c]),l&&!H(o.getOffset(),l)&&o.setOffset(l),o.isDraggable()!==E&&o.setDraggable(E),o.getRotation()!==f&&o.setRotation(f),o.getRotationAlignment()!==m&&o.setRotationAlignment(m),o.getPitchAlignment()!==S&&o.setPitchAlignment(S),o.getPopup()!==d&&o.setPopup(d);const x=O(A.className,e.className);if(x)for(const L of x)o.toggleClassName(L);return r.current.props=e,I.createPortal(e.children,o.getElement())}));a.memo(a.forwardRef((e,n)=>{const{map:t,mapLib:i}=a.useContext(M),r=a.useMemo(()=>document.createElement("div"),[]),o=a.useRef({props:e}),s=a.useMemo(()=>{const c={...e},l=new i.Popup(c);return l.setLngLat([e.longitude,e.latitude]),l.once("open",u=>{o.current.props.onOpen?.(u)}),l},[]);if(a.useEffect(()=>{const c=l=>{o.current.props.onClose?.(l)};return s.on("close",c),s.setDOMContent(r).addTo(t.getMap()),()=>{s.off("close",c),s.isOpen()&&s.remove()}},[]),a.useEffect(()=>{p(s.getElement(),e.style)},[e.style]),a.useImperativeHandle(n,()=>s,[]),s.isOpen()){const c=o.current.props;(s.getLngLat().lng!==e.longitude||s.getLngLat().lat!==e.latitude)&&s.setLngLat([e.longitude,e.latitude]),e.offset&&!h(c.offset,e.offset)&&s.setOffset(e.offset),(c.anchor!==e.anchor||c.maxWidth!==e.maxWidth)&&(s.options.anchor=e.anchor,s.setMaxWidth(e.maxWidth));const l=O(c.className,e.className);if(l)for(const u of l)s.toggleClassName(u);o.current.props=e}return I.createPortal(e.children,r)}));function _(e,n,t,i){const r=a.useContext(M),o=a.useMemo(()=>e(r),[]);return a.useEffect(()=>{const s=n,c=null,l=typeof n=="function"?n:null,{map:u}=r;return u.hasControl(o)||(u.addControl(o,s?.position),c&&c(r)),()=>{l&&l(r),u.hasControl(o)&&u.removeControl(o)}},[]),o}function Y(e){const n=_(({mapLib:t})=>new t.AttributionControl(e),{position:e.position});return a.useEffect(()=>{p(n._container,e.style)},[e.style]),null}a.memo(Y);function Q(e){const n=_(({mapLib:t})=>new t.FullscreenControl({container:e.containerId&&document.getElementById(e.containerId)}),{position:e.position});return a.useEffect(()=>{p(n._controlContainer,e.style)},[e.style]),null}a.memo(Q);function X(e,n){const t=a.useRef({props:e}),i=_(({mapLib:r})=>{const o=new r.GeolocateControl(e),s=o._setupUI;return o._setupUI=()=>{o._container.hasChildNodes()||s()},o.on("geolocate",c=>{t.current.props.onGeolocate?.(c)}),o.on("error",c=>{t.current.props.onError?.(c)}),o.on("outofmaxbounds",c=>{t.current.props.onOutOfMaxBounds?.(c)}),o.on("trackuserlocationstart",c=>{t.current.props.onTrackUserLocationStart?.(c)}),o.on("trackuserlocationend",c=>{t.current.props.onTrackUserLocationEnd?.(c)}),o},{position:e.position});return t.current.props=e,a.useImperativeHandle(n,()=>i,[]),a.useEffect(()=>{p(i._container,e.style)},[e.style]),null}a.memo(a.forwardRef(X));function ee(e){const n=_(({mapLib:t})=>new t.NavigationControl(e),{position:e.position});return a.useEffect(()=>{p(n._container,e.style)},[e.style]),null}const ce=a.memo(ee);function te(e){const n=_(({mapLib:o})=>new o.ScaleControl(e),{position:e.position}),t=a.useRef(e),i=t.current;t.current=e;const{style:r}=e;return e.maxWidth!==void 0&&e.maxWidth!==i.maxWidth&&(n.options.maxWidth=e.maxWidth),e.unit!==void 0&&e.unit!==i.unit&&n.setUnit(e.unit),a.useEffect(()=>{p(n._container,r)},[r]),null}a.memo(te);function ne(e){const n=_(({mapLib:t})=>new t.TerrainControl(e),{position:e.position});return a.useEffect(()=>{p(n._container,e.style)},[e.style]),null}a.memo(ne);function oe(e){const n=_(({mapLib:t})=>new t.LogoControl(e),{position:e.position});return a.useEffect(()=>{p(n._container,e.style)},[e.style]),null}a.memo(oe);export{M,ce as N,se as a,ae as b,h as d};
